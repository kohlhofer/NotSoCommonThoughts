---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();

// Get the main category from tags
const category = post.data.tags?.[0] || 'uncategorized';
const categoryName = category
  .split('-')
  .map(word => word.charAt(0).toUpperCase() + word.slice(1))
  .join(' ');
---

<Layout title={post.data.title}>
  <article class="max-w-2xl">
    <header class="mb-8">
      <!-- Mobile breadcrumb -->
      <div class="sm:hidden flex items-center gap-2 mb-6">
        <a href="/" class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
          ← Home
        </a>
        <span class="text-gray-400 dark:text-gray-600">/</span>
        <a href={`/${category}`} class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white">
          {categoryName}
        </a>
      </div>

      <!-- Desktop breadcrumb -->
      <div class="hidden sm:flex justify-between items-center text-sm text-gray-600 dark:text-gray-400 mb-4">
        <nav class="uppercase tracking-wide">
          <a href="/" class="hover:text-gray-900 dark:hover:text-white">HOME</a>
          <span class="mx-1">→</span>
          <a href={`/${category}`} class="hover:text-gray-900 dark:hover:text-white">{categoryName.toUpperCase()}</a>
        </nav>
        <time datetime={post.data.date.toISOString()} class="uppercase tracking-wide">
          {post.data.date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          })}
        </time>
      </div>

      <h1 class="text-5xl font-normal text-gray-900 dark:text-white mb-4 mt-8">
        {post.data.title}
      </h1>
    </header>
    <div class="prose prose-lg dark:prose-invert prose-headings:font-normal prose-a:text-primary-600 dark:prose-a:text-primary-400 max-w-none">
      <Content />
    </div>
  </article>
</Layout> 