---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import PostListItem from '../components/PostListItem.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  // Get all unique tags from all posts
  const categories = [...new Set(posts.flatMap(post => post.data.tags || ['uncategorized']))];
  
  return categories.map(category => {
    // Include posts that have this tag anywhere in their tags array
    const categoryPosts = posts.filter(post => 
      (post.data.tags || ['uncategorized']).includes(category)
    );
    const sortedPosts = categoryPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
    
    return {
      params: { category },
      props: { posts: sortedPosts, category }
    };
  });
}

const { posts, category } = Astro.props;
const categoryName = category
  .split('-')
  .map(word => word.charAt(0).toUpperCase() + word.slice(1))
  .join(' ');
---

<Layout title="Not So Common Thoughts">
  <div class="max-w-2xl">
    <!-- Mobile header -->
    <div class="sm:hidden flex items-center gap-2 mb-6">
      <a href="/" class="text-sm text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-200 transition-colors">
        ‚Üê Home
      </a>
      <span class="text-slate-400 dark:text-slate-600">/</span>
      <span class="text-sm text-slate-900 dark:text-slate-100">{categoryName}</span>
    </div>

    <!-- Desktop title -->
    <h1 class="hidden sm:block text-3xl font-serif text-slate-900 dark:text-slate-100 mb-8">
      {categoryName}
    </h1>

    <div class="space-y-6 sm:space-y-8">
      {posts.map(post => (
        <PostListItem post={post} />
      ))}
    </div>
  </div>
</Layout> 