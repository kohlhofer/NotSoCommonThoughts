---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import PostListItem from '../components/PostListItem.astro';

export async function getStaticPaths() {
  const posts = (await getCollection('blog')).filter(post => !post.data.unlisted);
  // Get all unique tags from all posts
  const categories = [...new Set(posts.flatMap(post => post.data.tags || ['uncategorized']))];
  
  return categories.map(category => {
    // Include posts that have this tag anywhere in their tags array
    const categoryPosts = posts.filter(post => 
      (post.data.tags || ['uncategorized']).includes(category)
    );
    const sortedPosts = categoryPosts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
    
    return {
      params: { category },
      props: { posts: sortedPosts, category }
    };
  });
}

const { posts, category } = Astro.props;
const categoryName = category
  .split('-')
  .map(word => word.charAt(0).toUpperCase() + word.slice(1))
  .join(' ');
---

<Layout title="Not So Common Thoughts">
  <div class="pt-8 sm:pt-12 pb-8 sm:pb-16">
    <!-- Hero Section -->
    <div class="max-w-4xl mx-auto px-8 mb-16">
      <div class="text-center">
        <h1 class="text-3xl sm:text-4xl font-serif text-slate-900 dark:text-slate-100 mb-4">
          {categoryName}
        </h1>
        <p class="text-slate-600 dark:text-slate-400 text-lg">
          {posts.length} post{posts.length === 1 ? '' : 's'} in this category
        </p>
      </div>
    </div>

    <!-- Posts List -->
    <div class="max-w-2xl mx-auto px-8">
      <div class="space-y-6 sm:space-y-8">
        {posts.map(post => (
          <PostListItem post={post} />
        ))}
      </div>
    </div>
  </div>
</Layout> 